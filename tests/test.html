<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 5//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <title>Test store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/2.5.3/mocha.css">
    <script src="../src/store.js"></script>
    <script src="../src/plugins/filter.js"></script>
    <script src="../src/plugins/sort.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/2.5.3/mocha.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/3.5.0/chai.min.js"></script>
    <style>
        body{
            padding: 20px;
            font-family: sans-serif;
        }
    </style>
</head>
<body>
    <h1>store test</h1>
    <div id="mocha"></div>
    <script>

        mocha.setup('tdd');

        suite('fx', function() {
            this.timeout(3000);
            var suite = window.suite,
                test = window.test,
                expect = chai.expect,
                d1 = [{id:1,value:'a', type: 'alpha', category: 'greek'},{id:1,value:'b', type: 'alpha', category: 'latin'},{id:3,value:'c', type: 'beta', category: 'greek'}],
                d2 = [{id:4,value:'d', type: 'beta', category: 'greek'},{id:5,value:'e', type: 'beta', category: 'greek'},{id:6,value:'f', type: 'alpha', category: 'latin'}],
                d3 = [{name:'foo',value:'foo', type: 'alpha', category: 'greek'},{name:'bar',value:'bar', type: 'beta', selected: true, category: 'greek'},
                    {name:'zap',value:'zap', type: 'omega'},{name:'pew',value:'pew', type: 'gamma', category: 'latin'}];

            function xsuite() {}
            function xtest() {}

            function values (items) {
                return items.map(function (item) {
                    return item.value
                }).join(',');
            }

            suite('store', function () {
                suite('get and set', function () {
                    test('it should get and set', function () {
                        var s = store();
                        s.add(d1);
                        expect(s.get()).to.equal(null);
                        expect(s.get(1).value).to.equal('a');
                        s.add(d2);
                        expect(s.fetch().length).to.equal(6);
                    });
                    test('it should handle items with a `name` identifier', function () {
                        var s = store({identifier: 'name'});
                        s.add(d3);
                        expect(s.get('zap').value).to.equal('zap');
                    });
                    test('it should get an item with an alternative attribute', function () {
                        var s = store({identifier: 'name'});
                        s.add(d3);
                        expect(s.get(true, 'selected').value).to.equal('bar');
                    });
                });

                suite('filter', function () {
                    test('it should filter on a set of params', function () {
                        var r, s = store({plugins:['filter']});
                        s.add(d1);
                        r = s.fetch({filter:{type:'alpha'}});
                        expect(values(r)).to.equal('a,b');
                    });
                    test('it should filter on OR params', function () {
                        var r, s = store({plugins:['filter']});
                        s.add(d1);
                        s.add(d2);
                        s.add(d3);
                        r = s.fetch({filter:{type:'alpha||omega'}});
                        expect(values(r)).to.equal('a,b,f,foo,zap');
                    });
                    test('it should filter on AND params', function () {
                        var r, s = store({plugins:['filter']});
                        s.add(d1);
                        r = s.fetch({filter:{type:'alpha',category:'latin'}});
                        expect(values(r)).to.equal('b');
                    });
                    test('it should filter on AND and OR params', function () {
                        var r, s = store({plugins:['filter']});
                        s.add(d1);
                        r = s.fetch({filter:{type:'alpha||beta',category:'greek'}});
                        expect(values(r)).to.equal('a,c');
                    });
                });

                suite('sort', function () {
                    test('it should sort on a set of params', function () {
                        var r, s = store({plugins: ['sort']});
                        s.add(d1);
                        r = s.fetch({sort: {key: 'value'}});
                        expect(values(r)).to.equal('a,b,c');
                    });
                    test('it should sort `asc` on a set of params', function () {
                        var r, s = store({plugins: ['sort']});
                        s.add(d1);
                        r = s.fetch({sort: {key: 'value', dir:'asc'}});
                        expect(values(r)).to.equal('c,b,a');
                    });
                });
            });
        });

        mocha.run();

    </script>
</body>
</html>